{% extends 'quotes/base.html' %}

{% block title %}–°–ª—É—á–∞–π–Ω–∞—è —Ü–∏—Ç–∞—Ç–∞{% endblock %}

{% block content %}
    {% if quote %}
        <div class="quote">
            <div class="quote-text">"{{ quote.text }}"</div>
            <div class="quote-source">{{ quote.source.name }} ({{ quote.source.get_source_type_display }})</div>
            
            <div class="vote-buttons">
                <button class="vote-btn {% if user_vote == 'like' %}active{% endif %}" 
                        onclick="vote({{ quote.id }}, true)">
                    üëç {{ likes_count }}
                </button>
                <button class="vote-btn {% if user_vote == 'dislike' %}active{% endif %}" 
                        onclick="vote({{ quote.id }}, false)">
                    üëé {{ dislikes_count }}
                </button>
            </div>
            
            <div class="stats">
                –ü—Ä–æ—Å–º–æ—Ç—Ä–æ–≤: {{ quote.views_count }} | –í–µ—Å: {{ quote.weight }}
            </div>
        </div>
        
        <button class="btn" onclick="location.reload()">–ù–æ–≤–∞—è —Ü–∏—Ç–∞—Ç–∞</button>
    {% else %}
        <p>–¶–∏—Ç–∞—Ç –ø–æ–∫–∞ –Ω–µ—Ç. <a href="{% url 'add_quote' %}">–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é!</a></p>
    {% endif %}

    <script>
        function vote(quoteId, isLike) {
            fetch(`/vote/${quoteId}/`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: `is_like=${isLike}`
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert(data.error);
                } else {
                    location.reload();
                }
            });
        }
    </script>
{% endblock %}


